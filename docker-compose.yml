version: '3.8'

services:
  app:
    build: .
    container_name: pharmacy-stock-ocr
    ports:
      - "8000:8000"
    volumes:
      # Development hot reload
      - ./main.py:/app/main.py
      - ./services:/app/services
      - ./templates:/app/templates
      - ./models:/app/models
      # Persistent uploads
      - uploads_data:/app/static/uploads
      # Credentials (make sure to add credentials.json before running)
      - ./credentials.json:/app/credentials.json:ro
    environment:
      - MISTRAL_API_KEY=${MISTRAL_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GCS_BUCKET_NAME=${GCS_BUCKET_NAME}
      - GCS_PROJECT_ID=${GCS_PROJECT_ID}
      - MASTER_SHEET_ID=${MASTER_SHEET_ID}
      - OUTPUT_SHEET_ID=${OUTPUT_SHEET_ID}
      - FUZZY_MATCH_THRESHOLD=${FUZZY_MATCH_THRESHOLD:-0.75}
      - MAX_UPLOAD_SIZE_MB=${MAX_UPLOAD_SIZE_MB:-10}
      - CACHE_TTL_SECONDS=${CACHE_TTL_SECONDS:-300}
    env_file:
      - .env
    restart: unless-stopped

volumes:
  uploads_data:
